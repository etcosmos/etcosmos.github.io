<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cosmos</title>
  <link rel="icon" type="image/png" href="https://ethanytangcodes.github.io/cosmos/logo.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{
      height:100vh;display:flex;flex-direction:column;
      align-items:center;justify-content:center;gap:36px;
      background:linear-gradient(135deg,#2d0a1a 0%,#3d1520 50%,#4d1f30 100%);
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
      overflow:hidden;position:relative;
    }
    body::before{
      content:'';position:fixed;inset:0;z-index:0;
      background:
        radial-gradient(ellipse at 20% 30%,rgba(222,49,99,.18),transparent 50%),
        radial-gradient(ellipse at 80% 70%,rgba(248,131,121,.18),transparent 50%);
      animation:cs 20s ease-in-out infinite;
    }
    @keyframes cs{0%,100%{opacity:1;transform:scale(1);}50%{opacity:.75;transform:scale(1.08);}}
    body::after{
      content:'';position:fixed;inset:0;z-index:0;
      background-image:
        radial-gradient(2px 2px at 15% 25%,rgba(255,255,255,.9),transparent),
        radial-gradient(1px 1px at 55% 65%,rgba(222,49,99,.8),transparent),
        radial-gradient(1px 1px at 80% 10%,rgba(248,131,121,.8),transparent),
        radial-gradient(1px 1px at 40% 80%,rgba(255,255,255,.5),transparent),
        radial-gradient(2px 2px at 90% 40%,rgba(248,131,121,.6),transparent);
      background-size:300% 300%;
      animation:stars 80s linear infinite;opacity:.6;
    }
    @keyframes stars{from{background-position:0 0;}to{background-position:-300% -300%;}}

    .wrap{
      position:relative;z-index:1;
      display:flex;flex-direction:column;align-items:center;gap:32px;
      animation:fadeUp .9s cubic-bezier(.22,1,.36,1) both;
    }
    @keyframes fadeUp{from{opacity:0;transform:translateY(28px);}to{opacity:1;transform:translateY(0);}}

    .brand{display:flex;align-items:center;gap:28px;}
    .brand-icon{
      width:130px;height:130px;
      background:linear-gradient(135deg,#DE3163,#F88379);
      border-radius:28px;padding:10px;
      display:flex;align-items:center;justify-content:center;
      box-shadow:0 0 50px rgba(222,49,99,.7),0 12px 30px rgba(0,0,0,.4);
    }
    .brand-icon img{width:100%;height:100%;object-fit:cover;border-radius:20px;}
    .brand-title{
      font-size:100px;font-weight:900;letter-spacing:-4px;
      background:linear-gradient(90deg,#DE3163,#F88379);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
    }

    .hint{
      font-size:15px;color:#b8b8c8;letter-spacing:.5px;text-align:center;
      background:rgba(45,10,26,.5);backdrop-filter:blur(10px);
      padding:10px 22px;border-radius:10px;border:1px solid rgba(222,49,99,.25);
    }

    .open-btn{
      display:flex;align-items:center;gap:14px;
      padding:18px 44px;border-radius:18px;border:none;cursor:pointer;
      font-weight:800;font-size:19px;letter-spacing:.3px;
      background:linear-gradient(135deg,#DE3163,#F88379);color:white;
      box-shadow:0 12px 45px rgba(222,49,99,.65),0 0 50px rgba(248,131,121,.35);
      transition:all .25s cubic-bezier(.34,1.56,.64,1);
    }
    .open-btn:hover{
      transform:translateY(-5px) scale(1.03);
      box-shadow:0 18px 60px rgba(222,49,99,.85),0 0 70px rgba(248,131,121,.55);
    }
    .open-btn:active{transform:translateY(-1px) scale(.99);}
  </style>
</head>
<body>

<div class="wrap">
  <div class="brand">
    <div class="brand-icon">
      <img src="https://ethanytangcodes.github.io/cosmos/logo.png" alt="Cosmos">
    </div>
    <h1 class="brand-title">Cosmos</h1>
  </div>
  <p class="hint">Allow popups for this site to open Cosmos</p>
  <button class="open-btn" id="openBtn">
    <i class="fas fa-rocket"></i>
    Open Cosmos
  </button>
</div>

<script>
// ═══════════════════════════════════════════════════════════
//  FULL COSMOS APP — injected into about:blank on click
//  (version check removed, download button added, no author)
// ═══════════════════════════════════════════════════════════
const APP_HTML = `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cosmos</title>
  <link rel="icon" type="image/png" href="https://ethanytangcodes.github.io/cosmos/logo.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js"><\\/script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;overflow:hidden;height:100vh;background:linear-gradient(135deg,#2d0a1a 0%,#3d1520 50%,#4d1f30 100%);position:relative;}
    body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(ellipse at 20% 30%,rgba(222,49,99,.15) 0%,transparent 50%),radial-gradient(ellipse at 80% 70%,rgba(248,131,121,.15) 0%,transparent 50%);z-index:0;animation:cosmicShift 20s ease-in-out infinite;}
    @keyframes cosmicShift{0%,100%{opacity:1;transform:scale(1);}50%{opacity:.8;transform:scale(1.1);}}
    body::after{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background-image:radial-gradient(2px 2px at 20% 30%,white,transparent),radial-gradient(1px 1px at 60% 70%,rgba(222,49,99,.8),transparent),radial-gradient(1px 1px at 80% 10%,rgba(248,131,121,.8),transparent);background-size:200% 200%;animation:stars 60s linear infinite;opacity:.5;z-index:0;}
    @keyframes stars{from{background-position:0 0;}to{background-position:-200% -200%;}}
    .container{display:flex;height:100vh;position:relative;z-index:1;}
    .sidebar{width:72px;background:rgba(45,10,26,.8);backdrop-filter:blur(20px);display:flex;flex-direction:column;align-items:center;padding:20px 0 16px;position:relative;z-index:100;border-right:1px solid rgba(222,49,99,.4);transition:width .2s ease;box-shadow:2px 0 20px rgba(0,0,0,.3);}
    .sidebar:hover{width:220px;box-shadow:4px 0 30px rgba(222,49,99,.3);}
    .sidebar-header{display:flex;align-items:center;justify-content:flex-start;margin-bottom:32px;width:100%;padding:0 16px;}
    .logo-container{display:flex;align-items:center;gap:12px;cursor:pointer;background:transparent;padding:0;border-radius:12px;transition:all .2s ease;}
    .sidebar:hover .logo-container{background:linear-gradient(135deg,#DE3163,#F88379);padding:8px 12px;box-shadow:0 0 20px rgba(222,49,99,.4);}
    .logo-icon{width:48px;height:48px;border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0;overflow:hidden;background:linear-gradient(135deg,#DE3163,#F88379);padding:4px;transition:all .2s ease;box-shadow:0 0 20px rgba(222,49,99,.6);}
    .sidebar:hover .logo-icon{background:transparent;padding:0;box-shadow:none;}
    .logo-icon img{width:100%;height:100%;object-fit:cover;border-radius:8px;}
    .logo-text{font-size:17px;font-weight:600;color:white;opacity:0;white-space:nowrap;transition:opacity .2s ease;letter-spacing:-.3px;}
    .sidebar:hover .logo-text{opacity:1;}
    .nav-items{flex:1;width:100%;display:flex;flex-direction:column;gap:2px;padding:0 12px;position:relative;}
    .nav-item{display:flex;align-items:center;padding:10px 12px;color:#b8b8c8;cursor:pointer;border-radius:10px;transition:all .15s ease;position:relative;text-decoration:none;}
    .nav-item:hover{background:rgba(222,49,99,.2);color:#e8e8f0;box-shadow:0 0 15px rgba(222,49,99,.3);}
    .nav-item.active{background:rgba(222,49,99,.3);color:#fff;box-shadow:0 0 20px rgba(222,49,99,.4);}
    .nav-icon{min-width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-size:16px;}
    .nav-text{margin-left:12px;font-size:14px;font-weight:500;white-space:nowrap;opacity:0;transition:opacity .2s ease;}
    .sidebar:hover .nav-text{opacity:1;}
    .nav-indicator{position:absolute;left:0;width:4px;height:40px;background:linear-gradient(180deg,#DE3163,#F88379);border-radius:0 4px 4px 0;transition:top .3s ease;top:0;box-shadow:0 0 15px rgba(222,49,99,.6);}
    .main-content{flex:1;position:relative;overflow:hidden;background:transparent;}
    .content-frame{width:100%;height:100%;border:none;background:#fff;display:none;}
    .homepage{display:flex;flex-direction:column;height:100%;width:100%;}
    .top-bar{display:flex;justify-content:space-between;align-items:center;padding:24px 40px;background:rgba(45,10,26,.6);backdrop-filter:blur(20px);border-bottom:1px solid rgba(222,49,99,.3);}
    .info-item{display:flex;align-items:center;gap:8px;font-size:14px;color:#b8b8c8;}
    .info-icon{font-size:16px;color:#DE3163;}
    .info-value{font-weight:500;color:#e8e8f0;}
    .center-content{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px;gap:24px;}
    .brand-display{display:flex;align-items:center;gap:24px;animation:fadeInUp .8s ease;}
    @keyframes fadeInUp{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
    .brand-icon{width:140px;height:140px;background:linear-gradient(135deg,#DE3163,#F88379);border-radius:24px;padding:8px;display:flex;align-items:center;justify-content:center;box-shadow:0 0 40px rgba(222,49,99,.6);}
    .brand-icon img{width:100%;height:100%;object-fit:cover;border-radius:20px;}
    .brand-title{font-size:96px;font-weight:800;letter-spacing:-2px;background:linear-gradient(90deg,#DE3163,#F88379);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
    .acronym-text{color:#fff;font-size:18px;font-weight:500;text-align:center;text-shadow:0 0 15px rgba(248,131,121,.3);}
    .typewriter{font-size:28px;color:#F88379;font-weight:500;min-height:40px;text-align:center;text-shadow:0 0 20px rgba(248,131,121,.4);}
    .dl-btn{display:inline-flex;align-items:center;gap:10px;padding:14px 30px;border-radius:14px;background:linear-gradient(135deg,#DE3163,#F88379);color:white;text-decoration:none;font-weight:700;font-size:16px;box-shadow:0 8px 30px rgba(222,49,99,.5);transition:all .25s ease;margin-top:8px;}
    .dl-btn:hover{transform:translateY(-3px);box-shadow:0 14px 45px rgba(222,49,99,.75);}
    .cloak-button{position:fixed;bottom:100px;right:30px;width:60px;height:60px;border-radius:50%;background:white;border:none;cursor:pointer;box-shadow:0 4px 20px rgba(0,0,0,.3);display:flex;align-items:center;justify-content:center;transition:all .3s ease;z-index:1000;}
    .cloak-button i{font-size:24px;color:#2d0a1a;transition:all .3s ease;}
    .cloak-button.active{background:linear-gradient(135deg,#DE3163,#F88379);}
    .cloak-button.active i{color:white;}
    .cloak-button:hover{transform:scale(1.1);box-shadow:0 6px 30px rgba(222,49,99,.5);}
    .cloak-menu{position:fixed;bottom:170px;right:30px;width:300px;background:rgba(45,10,26,.95);backdrop-filter:blur(20px);border-radius:20px;border:2px solid rgba(222,49,99,.4);box-shadow:0 8px 32px rgba(0,0,0,.4),0 0 40px rgba(222,49,99,.2);z-index:999;display:none;animation:slideUp .3s ease;padding:20px;}
    .cloak-menu.open{display:block;}
    .cloak-menu h3{font-size:18px;background:linear-gradient(90deg,#DE3163,#F88379);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:15px;}
    .cloak-preset{display:flex;align-items:center;gap:12px;padding:12px;margin:8px 0;background:rgba(10,14,39,.6);border-radius:10px;cursor:pointer;transition:all .3s ease;border:2px solid transparent;}
    .cloak-preset:hover{background:rgba(222,49,99,.2);border-color:rgba(222,49,99,.4);box-shadow:0 0 15px rgba(222,49,99,.3);}
    .cloak-preset.active{background:rgba(222,49,99,.3);border-color:#DE3163;box-shadow:0 0 20px rgba(222,49,99,.4);}
    .cloak-preset img{width:24px;height:24px;object-fit:contain;}
    .cloak-preset-info{flex:1;}
    .cloak-preset-title{font-size:14px;font-weight:600;color:white;margin-bottom:2px;}
    .cloak-preset-url{font-size:11px;color:#b8b8c8;}
    .reset-cloak{width:100%;padding:12px;margin-top:12px;background:rgba(255,107,107,.2);border:2px solid rgba(255,107,107,.4);color:#ff6b6b;border-radius:10px;cursor:pointer;font-weight:600;transition:all .3s ease;}
    .reset-cloak:hover{background:rgba(255,107,107,.3);box-shadow:0 0 20px rgba(255,107,107,.4);}
    .chat-button{position:fixed;bottom:30px;right:30px;width:60px;height:60px;border-radius:50%;background:white;border:none;cursor:pointer;box-shadow:0 4px 20px rgba(0,0,0,.3);display:flex;align-items:center;justify-content:center;transition:all .3s ease;z-index:1000;}
    .chat-button i{font-size:24px;color:#2d0a1a;transition:all .3s ease;}
    .chat-button.active{background:linear-gradient(135deg,#DE3163,#F88379);}
    .chat-button.active i{color:white;}
    .chat-button:hover{transform:scale(1.1);box-shadow:0 6px 30px rgba(222,49,99,.5);}
    .chat-widget{position:fixed;bottom:100px;right:30px;width:400px;max-width:calc(100vw - 60px);background:rgba(45,10,26,.95);backdrop-filter:blur(20px);border-radius:20px;border:2px solid rgba(222,49,99,.4);box-shadow:0 8px 32px rgba(0,0,0,.4),0 0 40px rgba(222,49,99,.2);z-index:999;display:none;animation:slideUp .3s ease;}
    .chat-widget.open{display:block;}
    @keyframes slideUp{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
    .chat-header{padding:20px;border-bottom:1px solid rgba(222,49,99,.3);}
    .chat-header h3{font-size:20px;background:linear-gradient(90deg,#DE3163,#F88379);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:5px;}
    .chat-header p{font-size:13px;color:#b8b8c8;line-height:1.4;}
    .chat-body{padding:20px;}
    .chat-body input,.chat-body textarea{width:100%;margin:10px 0;padding:12px;border-radius:10px;border:2px solid rgba(222,49,99,.3);background:rgba(10,14,39,.6);color:white;font-family:inherit;transition:all .3s ease;}
    .chat-body input::placeholder,.chat-body textarea::placeholder{color:rgba(232,232,240,.5);}
    .chat-body input:focus,.chat-body textarea:focus{outline:none;border-color:#DE3163;background:rgba(10,14,39,.8);box-shadow:0 0 20px rgba(222,49,99,.4);}
    .chat-body textarea{min-height:100px;resize:vertical;}
    .chat-body button{width:100%;padding:12px;border-radius:10px;border:none;background:linear-gradient(135deg,#DE3163,#F88379);color:white;font-weight:600;cursor:pointer;transition:all .3s ease;margin-top:10px;}
    .chat-body button:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 10px 30px rgba(222,49,99,.5),0 0 40px rgba(248,131,121,.3);}
    .chat-body button:disabled{background:rgba(58,58,58,.6);cursor:not-allowed;color:#888;}
    #chatStatus{text-align:center;font-size:14px;margin-top:10px;color:#DE3163;}
    ::-webkit-scrollbar{width:10px;}
    ::-webkit-scrollbar-track{background:rgba(10,14,39,.6);}
    ::-webkit-scrollbar-thumb{background:linear-gradient(180deg,#DE3163,#F88379);border-radius:10px;}
    @media(max-width:768px){.chat-widget{width:calc(100vw - 40px);right:20px;bottom:90px;}.chat-button{right:20px;bottom:20px;}.cloak-button{right:20px;bottom:90px;}.cloak-menu{right:20px;bottom:160px;width:calc(100vw - 40px);}}
  </style>
</head>
<body>
<div class="container">
  <div class="sidebar">
    <div class="sidebar-header">
      <div class="logo-container">
        <div class="logo-icon"><img src="https://ethanytangcodes.github.io/cosmos/logo.png" alt="Cosmos Logo"></div>
        <div class="logo-text">Cosmos</div>
      </div>
    </div>
    <div class="nav-items">
      <div class="nav-indicator"></div>
      <a class="nav-item active" data-page="home"><span class="nav-icon"><i class="fas fa-home"></i></span><span class="nav-text">Home</span></a>
      <a class="nav-item" data-page="iframe" data-url="https://ethanytangcodes.github.io/art"><span class="nav-icon"><i class="fas fa-gamepad"></i></span><span class="nav-text">Games</span></a>
      <a class="nav-item" data-page="iframe" data-url="https://ethanytangcodes.github.io/gamebois"><span class="nav-icon"><i class="fas fa-ghost"></i></span><span class="nav-text">Gameboy</span></a>
      <a class="nav-item" data-page="iframe" data-url="https://ethanytangcodes.github.io/ai"><span class="nav-icon"><i class="fas fa-brain"></i></span><span class="nav-text">AI</span></a>
      <a class="nav-item" data-page="iframe" data-url="https://ethanytangcodes.github.io/mc"><span class="nav-icon"><i class="fas fa-cube"></i></span><span class="nav-text">Minecraft</span></a>
      <a class="nav-item" data-page="iframe" data-url="https://ethanytangcodes.github.io/spotify"><span class="nav-icon"><i class="fas fa-music"></i></span><span class="nav-text">Music Player</span></a>
    </div>
  </div>
  <div class="main-content">
    <div class="homepage" id="homePage">
      <div class="top-bar">
        <div class="info-item"><i class="fas fa-clock info-icon"></i><span class="info-value" id="currentTime">--:--:--</span></div>
        <div class="info-item"><i class="fas fa-calendar info-icon"></i><span class="info-value" id="currentDate">Loading...</span></div>
        <div class="info-item"><i class="fas fa-cloud-sun info-icon"></i><span class="info-value" id="weather">Loading weather...</span></div>
      </div>
      <div class="center-content">
        <div class="brand-display">
          <div class="brand-icon"><img src="https://ethanytangcodes.github.io/cosmos/logo.png" alt="Cosmos"></div>
          <h1 class="brand-title">Cosmos</h1>
        </div>
        <h4 class="acronym-text">Cryptographic Omnivalent Strategic Module to Outmaneuver S*curly</h4>
        <div class="typewriter" id="typewriter"></div>
        <a href="https://raw.githubusercontent.com/ethanytangcodes/cosmos/refs/heads/main/singlefilecosmos.html" download="cosmos.html" class="dl-btn">
          <i class="fas fa-download"></i> Download Cosmos
        </a>
      </div>
    </div>
  </div>
</div>

<button class="cloak-button" id="cloakBtn"><i class="fas fa-mask"></i></button>
<div class="cloak-menu" id="cloakMenu">
  <h3><i class="fas fa-mask"></i> Tab Cloaking</h3>
  <div class="cloak-preset" data-title="My Drive - Google Drive" data-icon="https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_32dp.png"><img src="https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_32dp.png" alt=""><div class="cloak-preset-info"><div class="cloak-preset-title">Google Drive</div><div class="cloak-preset-url">drive.google.com</div></div></div>
  <div class="cloak-preset" data-title="Gmail" data-icon="https://ssl.gstatic.com/ui/v1/icons/mail/rfr/gmail.ico"><img src="https://ssl.gstatic.com/ui/v1/icons/mail/rfr/gmail.ico" alt=""><div class="cloak-preset-info"><div class="cloak-preset-title">Gmail</div><div class="cloak-preset-url">mail.google.com</div></div></div>
  <div class="cloak-preset" data-title="Clever | Portal" data-icon="https://clever.com/favicon.ico"><img src="https://ethanytangcodes.github.io/clever.png" alt=""><div class="cloak-preset-info"><div class="cloak-preset-title">Clever</div><div class="cloak-preset-url">clever.com</div></div></div>
  <div class="cloak-preset" data-title="Home" data-icon="https://ssl.gstatic.com/classroom/favicon.png"><img src="https://ssl.gstatic.com/classroom/favicon.png" alt=""><div class="cloak-preset-info"><div class="cloak-preset-title">Google Classroom</div><div class="cloak-preset-url">classroom.google.com</div></div></div>
  <div class="cloak-preset" data-title="Google Docs" data-icon="https://ssl.gstatic.com/docs/documents/images/kix-favicon7.ico"><img src="https://ssl.gstatic.com/docs/documents/images/kix-favicon7.ico" alt=""><div class="cloak-preset-info"><div class="cloak-preset-title">Google Docs</div><div class="cloak-preset-url">docs.google.com</div></div></div>
  <div style="margin-top:16px;padding-top:16px;border-top:1px solid rgba(222,49,99,.3);">
    <h3 style="font-size:16px;margin-bottom:12px;"><i class="fas fa-edit"></i> Custom Cloak</h3>
    <input type="text" id="customTitle" placeholder="Tab Title" style="width:100%;padding:10px;margin-bottom:8px;border-radius:8px;border:2px solid rgba(222,49,99,.3);background:rgba(10,14,39,.6);color:white;font-size:13px;">
    <input type="url" id="customIcon" placeholder="Favicon URL" style="width:100%;padding:10px;margin-bottom:10px;border-radius:8px;border:2px solid rgba(222,49,99,.3);background:rgba(10,14,39,.6);color:white;font-size:13px;">
    <button id="applyCustomCloak" style="width:100%;padding:10px;background:linear-gradient(135deg,#DE3163,#F88379);color:white;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:13px;"><i class="fas fa-check"></i> Apply</button>
  </div>
  <button class="reset-cloak" id="resetCloak"><i class="fas fa-undo"></i> Reset to Default</button>
</div>

<button class="chat-button" id="chatBtn"><i class="fas fa-comment-dots"></i></button>
<div class="chat-widget" id="chatWidget">
  <div class="chat-header"><h3>Suggestions & Feedback</h3><p>Share your suggestions, feedback, or report any issues.</p></div>
  <div class="chat-body">
    <form id="feedbackForm">
      <input type="text" id="fname" placeholder="Your Name (optional)"/>
      <input type="email" id="femail" placeholder="Your Email (optional)"/>
      <textarea id="fmessage" placeholder="Suggest a game or share feedback" required></textarea>
      <button type="submit" id="submitBtn">Submit Feedback</button>
      <p id="chatStatus"></p>
    </form>
  </div>
</div>

<script>
// TAB CLOAKING
const cloakPresets=document.querySelectorAll('.cloak-preset'),cloakBtn=document.getElementById('cloakBtn'),cloakMenu=document.getElementById('cloakMenu'),resetCloakBtn=document.getElementById('resetCloak'),origTitle=document.title,origIcon=document.querySelector('link[rel="icon"]').href;
function applyCloak(t,i){document.title=t;let l=document.querySelector('link[rel="icon"]')||document.createElement('link');l.rel='icon';l.type='image/png';l.href=i;if(!document.querySelector('link[rel="icon"]'))document.head.appendChild(l);}
const sc=localStorage.getItem('tabCloak');if(sc){const d=JSON.parse(sc);applyCloak(d.title,d.icon);cloakPresets.forEach(p=>{if(p.dataset.title===d.title)p.classList.add('active');});}
cloakBtn.addEventListener('click',e=>{e.stopPropagation();cloakMenu.classList.toggle('open');cloakBtn.classList.toggle('active');});
document.addEventListener('click',e=>{if(!cloakMenu.contains(e.target)&&!cloakBtn.contains(e.target)){cloakMenu.classList.remove('open');cloakBtn.classList.remove('active');}});
cloakMenu.addEventListener('click',e=>e.stopPropagation());
cloakPresets.forEach(p=>p.addEventListener('click',()=>{applyCloak(p.dataset.title,p.dataset.icon);localStorage.setItem('tabCloak',JSON.stringify({title:p.dataset.title,icon:p.dataset.icon}));cloakPresets.forEach(x=>x.classList.remove('active'));p.classList.add('active');cloakMenu.classList.remove('open');cloakBtn.classList.remove('active');}));
resetCloakBtn.addEventListener('click',()=>{applyCloak(origTitle,origIcon);localStorage.removeItem('tabCloak');cloakPresets.forEach(x=>x.classList.remove('active'));cloakMenu.classList.remove('open');cloakBtn.classList.remove('active');});
document.getElementById('applyCustomCloak').addEventListener('click',()=>{const t=document.getElementById('customTitle').value.trim(),i=document.getElementById('customIcon').value.trim();if(!t||!i){alert('Fill in both fields!');return;}applyCloak(t,i);localStorage.setItem('tabCloak',JSON.stringify({title:t,icon:i}));cloakPresets.forEach(x=>x.classList.remove('active'));document.getElementById('customTitle').value='';document.getElementById('customIcon').value='';cloakMenu.classList.remove('open');cloakBtn.classList.remove('active');});
// TIME
function updateTime(){const n=new Date();document.getElementById('currentTime').textContent=n.toLocaleTimeString();document.getElementById('currentDate').textContent=n.toLocaleDateString([],{weekday:'long',month:'long',day:'numeric'});}
setInterval(updateTime,1000);updateTime();
// WEATHER
async function loadWeather(){try{const ip=await fetch('https://ipinfo.io/json?token=be26bfc118c4b0').then(r=>r.json());const[lat,lon]=ip.loc.split(',');const w=await fetch('https://api.open-meteo.com/v1/forecast?latitude='+lat+'&longitude='+lon+'&current_weather=true').then(r=>r.json());const names={0:'Clear',1:'Mainly Clear',2:'Partly Cloudy',3:'Cloudy',45:'Fog',48:'Fog',51:'Drizzle',61:'Rain',80:'Rain',95:'Storm'};document.getElementById('weather').textContent=ip.city+' \u2022 '+(names[w.current_weather.weathercode]??'Weather')+' \u2022 '+w.current_weather.temperature+'\u00b0C';}catch{document.getElementById('weather').textContent='Weather unavailable';}}
loadWeather();
// TYPEWRITER
const phrases=["MeGA kNiGhT","bored?","just do work by now bro","TEACHERRRRR","now with tab cloaking"];
let twi;function startTyping(){const el=document.getElementById('typewriter');if(!el)return;clearInterval(twi);const text=phrases[Math.floor(Math.random()*phrases.length)];let i=0;el.textContent='';twi=setInterval(()=>{if(i<text.length){el.textContent+=text[i++];}else clearInterval(twi);},100);}
document.readyState==='loading'?document.addEventListener('DOMContentLoaded',startTyping):startTyping();
// NAVIGATION
const navItems=document.querySelectorAll('.nav-item'),homePage=document.getElementById('homePage'),indicator=document.querySelector('.nav-indicator');
const iframeUrls=[...navItems].filter(n=>n.dataset.page==='iframe').map(n=>n.dataset.url);
const piframes={};
iframeUrls.forEach(url=>{const f=document.createElement('iframe');f.src=url;f.className='content-frame';f.setAttribute('sandbox','allow-scripts allow-pointer-lock allow-same-origin allow-forms allow-downloads allow-popups allow-modals allow-presentation allow-orientation-lock allow-popups-to-escape-sandbox allow-top-navigation');document.querySelector('.main-content').appendChild(f);piframes[url]=f;});
function moveInd(item){indicator.style.top=item.offsetTop+'px';indicator.style.height=item.offsetHeight+'px';}
const ia=document.querySelector('.nav-item.active');if(ia)moveInd(ia);
navItems.forEach(item=>item.addEventListener('click',e=>{e.preventDefault();navItems.forEach(n=>n.classList.remove('active'));item.classList.add('active');moveInd(item);homePage.style.display='none';Object.values(piframes).forEach(f=>f.style.display='none');if(item.dataset.page==='home'){homePage.style.display='flex';setTimeout(startTyping,100);}if(item.dataset.page==='iframe')piframes[item.dataset.url].style.display='block';}));
// FEEDBACK
const chatBtn=document.getElementById('chatBtn'),chatWidget=document.getElementById('chatWidget'),form=document.getElementById('feedbackForm'),statusEl=document.getElementById('chatStatus'),submitBtn=document.getElementById('submitBtn');
const webhookWorker='https://apply.ethantytang11.workers.dev/',cooldownKey='feedbackCooldown',cooldownMs=86400000;
const hv=localStorage.getItem('hasVisitedCosmos');if(!hv){setTimeout(()=>{chatWidget.classList.add('open');chatBtn.classList.add('active');},500);localStorage.setItem('hasVisitedCosmos','true');}
chatBtn.addEventListener('click',e=>{e.stopPropagation();chatWidget.classList.toggle('open');chatBtn.classList.toggle('active');});
document.addEventListener('click',e=>{if(!chatWidget.contains(e.target)&&!chatBtn.contains(e.target)){chatWidget.classList.remove('open');chatBtn.classList.remove('active');}});
chatWidget.addEventListener('click',e=>e.stopPropagation());
const ls=localStorage.getItem(cooldownKey);if(ls&&Date.now()-ls<cooldownMs){statusEl.textContent='\u23f3 Try again in about '+Math.ceil((cooldownMs-(Date.now()-ls))/3600000)+' hours.';submitBtn.disabled=true;}
form.addEventListener('submit',async e=>{e.preventDefault();submitBtn.disabled=true;statusEl.textContent='Submitting...';try{const fp=await FingerprintJS.load();const r=await fp.get();const ip=await fetch('https://ipinfo.io/json?token=d3c139f7603b13').then(x=>x.json());await fetch(webhookWorker,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name:document.getElementById('fname').value,email:document.getElementById('femail').value,message:document.getElementById('fmessage').value,fingerprint:r.visitorId,ip:ip.ip,location:ip.city+', '+ip.region+', '+ip.country,org:ip.org,time:new Date().toLocaleString(),userAgent:navigator.userAgent})});localStorage.setItem(cooldownKey,Date.now());statusEl.textContent='\u2705 Submitted!';setTimeout(()=>{form.reset();statusEl.textContent='';},3000);}catch(err){statusEl.textContent='\u274c Error. Try again later.';submitBtn.disabled=false;}});
<\/script>
</body>
</html>`;

// ═══════════════════════════════════════════
//  OPEN IN ABOUT:BLANK
// ═══════════════════════════════════════════
document.getElementById('openBtn').addEventListener('click', () => {
  const win = window.open('about:blank', '_blank');
  if (!win || win.closed || typeof win.closed === 'undefined') {
    // Popup blocked — page already shows the allow-popups hint, nothing else to do
    return;
  }
  win.document.open();
  win.document.write(APP_HTML);
  win.document.close();
});
</script>
</body>
</html>
